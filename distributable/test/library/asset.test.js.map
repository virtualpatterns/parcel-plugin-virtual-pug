{"version":3,"sources":["../../../source/test/library/asset.test.js"],"names":["Bundler","CreateRealContent","Format","Path","Pug","Test","Plugin","FilePath","_URL","fileURLToPath","import","meta","url","FolderPath","dirname","Require","_createRequire","test","bundler","resolve","bundle","local","module","virtualContentFn","default","virtualContent","map","realContent","toString","join","realContentFn","compileFile","log","is"],"mappings":"gFAAA,OAAOA,OAAP,MAAoB,gBAApB;AACA,OAAOC,iBAAP,MAA8B,+BAA9B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,GAAP,MAAgB,KAAhB;AACA,OAAOC,IAAP,MAAiB,KAAjB;;AAEA,OAAOC,MAAP,MAAmB,gBAAnB;;AAEA,MAAMC,QAAQ,GATdC,IAAI,CAACC,aAAL,CAAmBC,MAAM,CAACC,IAAP,CAAYC,GAA/B,CASA;AACA,MAAMC,UAAU,GAAGV,IAAI,CAACW,OAAL,CAAaP,QAAb,CAAnB;AACA,MAAMQ,OAAO,GAXbC,cAAc,CAACN,MAAM,CAACC,IAAP,CAAYC,GAAb,CAWd;;AAEAP,IAAI,CAAC,2DAAD,EAA8D,MAAOY,IAAP,IAAgB;;AAEhF,MAAIC,OAAO,GAAG,IAAIlB,OAAJ,CAAYe,OAAO,CAACI,OAAR,CAAgB,oBAAhB,CAAZ,EAAmD;AAC/D,aAAS,KADsD;AAE/D,cAAW,GAAEN,UAAW,SAFuC;AAG/D,eAAW,YAHoD;AAI/D,cAAU,MAJqD;AAK/D,aAAS,KALsD;AAM/D,gBAAY,CANmD,EAAnD,CAAd;;;AASA,QAAMP,MAAM,CAACY,OAAD,CAAZ;AACA,QAAMA,OAAO,CAACE,MAAR,EAAN;;AAEA;;AAEA,MAAIC,KAAK,GAAG,EAAE,QAAQ,KAAV,EAAZ;;AAEA,MAAIC,MAAM,GAAG,MAAM,OAAOP,OAAO,CAACI,OAAR,CAAgB,qBAAhB,CAAP,CAAnB;AACA,MAAII,gBAAgB,GAAGD,MAAM,CAACE,OAAP,CAAeA,OAAtC;;AAEA,MAAIC,cAAc,GAAG,IAArB;AACAA,EAAAA,cAAc,GAAGF,gBAAgB,CAACF,KAAD,CAAjC;AACAI,EAAAA,cAAc,GAAGA,cAAc;AAC5BC,EAAAA,GADc,CACTD,cAAD,IAAoBxB,iBAAiB,CAACwB,cAAD,CAD3B;AAEdC,EAAAA,GAFc,CAETC,WAAD,IAAiBA,WAAW,CAACC,QAAZ,EAFP;AAGdC,EAAAA,IAHc,CAGT,IAHS,CAAjB;;AAKAJ,EAAAA,cAAc,GAAGvB,MAAM,CAACuB,cAAD,CAAvB;;AAEA,MAAIK,aAAa,GAAG1B,GAAG,CAAC2B,WAAJ,CAAgBhB,OAAO,CAACI,OAAR,CAAgB,qBAAhB,CAAhB,CAApB;AACA,MAAIQ,WAAW,GAAGzB,MAAM,CAAC4B,aAAa,CAACT,KAAD,CAAd,CAAxB;;AAEAJ,EAAAA,IAAI,CAACe,GAAL,CAAU,oBAAmBP,cAAe,EAA5C;AACAR,EAAAA,IAAI,CAACe,GAAL,CAAU,oBAAmBL,WAAY,EAAzC;AACAV,EAAAA,IAAI,CAACgB,EAAL,CAAQR,cAAR,EAAwBE,WAAxB;;AAED,CArCG,CAAJ","sourcesContent":["import Bundler from 'parcel-bundler'\nimport CreateRealContent from 'virtual-dom/create-element.js'\nimport Format from 'pretty'\nimport Path from 'path'\nimport Pug from 'pug'\nimport Test from 'ava'\n\nimport Plugin from '../../index.js'\n\nconst FilePath = __filePath\nconst FolderPath = Path.dirname(FilePath)\nconst Require = __require\n\nTest('Bundler(Require.resolve(\\'./source/source.js\\'), { ... })', async (test) => {\n\n  let bundler = new Bundler(Require.resolve('./source/source.js'), {\n    'cache': false,\n    'outDir': `${FolderPath}/target`,\n    'outFile': 'target.cjs',\n    'target': 'node',\n    'watch': false,\n    'logLevel': 0\n  })\n\n  await Plugin(bundler)\n  await bundler.bundle()\n\n  // bundle produces CommonJS which import loads as ESModule ... which fails\n  \n  let local = { 'name': 'Bob' }\n\n  let module = await import(Require.resolve('./target/target.cjs'))\n  let virtualContentFn = module.default.default\n\n  let virtualContent = null\n  virtualContent = virtualContentFn(local)\n  virtualContent = virtualContent\n    .map((virtualContent) => CreateRealContent(virtualContent)) \n    .map((realContent) => realContent.toString())\n    .join('\\n')\n\n  virtualContent = Format(virtualContent)\n\n  let realContentFn = Pug.compileFile(Require.resolve('./source/source.pug'))\n  let realContent = Format(realContentFn(local))\n\n  test.log(`virtualContent = ${virtualContent}`)\n  test.log(`   realContent = ${realContent}`)\n  test.is(virtualContent, realContent)\n\n})\n"],"file":"asset.test.js"}